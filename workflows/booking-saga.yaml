main:
  params: [bookingId]
  steps:
    - saga:
        try:
          steps:
            - pricing:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/pricing
                  body:
                    bookingId: ${bookingId}
                result: pricingResult

            - discount:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/discount
                  body:
                    bookingId: ${bookingId}
                result: discountResult

            - quota:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/quota
                  body:
                    bookingId: ${bookingId}
                result: quotaResult

            - confirm:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/confirm
                  body:
                    bookingId: ${bookingId}

            - success:
                return: "BOOKING_CONFIRMED"

        except:
          as: error
          steps:
            - compensate:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/compensate
                  body:
                    bookingId: ${bookingId}
                    reason: ${error.message}

            - failed:
                return: "BOOKING_FAILED"
