main:
  params: [bookingId]
  steps:
    - pricing:
        try:
          call: http.post
          args:
            url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/pricing
            body:
              bookingId: ${bookingId}
        except:
          steps:
            - compensate_pricing:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/compensate
                  body:
                    bookingId: ${bookingId}
                    reason: "pricing_failed"
            - stop_pricing:
                return: "BOOKING_FAILED"

    - discount:
        try:
          call: http.post
          args:
            url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/discount
            body:
              bookingId: ${bookingId}
        except:
          steps:
            - compensate_discount:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/compensate
                  body:
                    bookingId: ${bookingId}
                    reason: "discount_failed"
            - stop_discount:
                return: "BOOKING_FAILED"

    - quota:
        try:
          call: http.post
          args:
            url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/quota
            body:
              bookingId: ${bookingId}
        except:
          steps:
            - compensate_quota:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/compensate
                  body:
                    bookingId: ${bookingId}
                    reason: "quota_failed"
            - stop_quota:
                return: "BOOKING_FAILED"

    - confirm:
        try:
          call: http.post
          args:
            url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/confirm
            body:
              bookingId: ${bookingId}
        except:
          steps:
            - compensate_confirm:
                call: http.post
                args:
                  url: https://medical-booking-system-1072885061741.asia-south2.run.app/booking/compensate
                  body:
                    bookingId: ${bookingId}
                    reason: "confirm_failed"
            - stop_confirm:
                return: "BOOKING_FAILED"

    - success:
        return: "BOOKING_CONFIRMED"
